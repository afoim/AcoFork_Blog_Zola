<!DOCTYPE html>
<html lang="zh" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hugo博客搭建教程以及配置调优 - AcoFork Blog</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css"/>
    <link rel="icon" href="https://q2.qlogo.cn/headimg_dl?dst_uin=2726730791&amp;spec=0">
    <script src="https://pic1.acofork.com/random.js"></script>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.acofork.com/rss.xml">
    <script src="/js/main.js"></script>
</head>
<body class="bg-[var(--page-bg)] text-gray-900 dark:text-gray-100 transition-colors duration-300 min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md shadow-sm dark:border-b dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <a href="/" class="text-xl font-bold text-blue-600 dark:text-blue-400">AcoFork Blog</a>
                    </div>
                    <!-- Desktop Menu -->
                    <div class="hidden md:ml-6 md:flex md:space-x-8">
                        
                        <a href="&#x2F;" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           >
                            首页
                        </a>
                        
                        <a href="&#x2F;posts" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           >
                            归档
                        </a>
                        
                        <a href="&#x2F;friends" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           >
                            友链
                        </a>
                        
                        <a href="&#x2F;sponsors" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           >
                            赞助
                        </a>
                        
                        <a href="https:&#x2F;&#x2F;umami.acofork.com&#x2F;share&#x2F;CdkXbGgZr6ECKOyK" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           target="_blank">
                            统计
                        </a>
                        
                        <a href="https:&#x2F;&#x2F;status.acofork.com" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           target="_blank">
                            监控
                        </a>
                        
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Mobile Menu Button -->
                    <button type="button" onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                        <span class="sr-only">Open menu</span>
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <!-- Search Button -->
                    <button onclick="toggleSearch()" class="p-2 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                    <!-- Theme Toggle -->
                    <button onclick="toggleTheme()" class="p-2 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                        <svg id="sun-icon" class="h-6 w-6 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <svg id="moon-icon" class="h-6 w-6 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
            <div class="px-2 pt-2 pb-3 space-y-1">
                
                <a href="&#x2F;" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   >
                    首页
                </a>
                
                <a href="&#x2F;posts" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   >
                    归档
                </a>
                
                <a href="&#x2F;friends" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   >
                    友链
                </a>
                
                <a href="&#x2F;sponsors" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   >
                    赞助
                </a>
                
                <a href="https:&#x2F;&#x2F;umami.acofork.com&#x2F;share&#x2F;CdkXbGgZr6ECKOyK" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   target="_blank">
                    统计
                </a>
                
                <a href="https:&#x2F;&#x2F;status.acofork.com" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   target="_blank">
                    监控
                </a>
                
            </div>
        </div>
    </nav>

    <!-- Search Modal -->
    <div id="search-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="toggleSearch()"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto p-4 sm:p-6 md:p-20" onclick="if(event.target === this) toggleSearch()">
            <div class="mx-auto max-w-xl transform rounded-xl bg-white dark:bg-gray-800 p-2 shadow-2xl transition-all">
                <input type="text" id="search-input" 
                       class="w-full rounded-md border-0 bg-gray-100 dark:bg-gray-700 px-4 py-2.5 text-gray-900 dark:text-white placeholder-gray-500 focus:ring-0 sm:text-sm" 
                       placeholder="搜索文章..." autocomplete="off">
                <ul id="search-results" class="max-h-96 scroll-py-3 overflow-y-auto p-3"></ul>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
<div class="max-w-4xl mx-auto">
    <!-- Post Header -->
    <header class="mb-8 text-center">
        <div class="flex items-center justify-center space-x-2 text-sm text-gray-500 dark:text-gray-400 mb-4">
            <time datetime="2025-03-03">2025-03-03</time>
            <span>•</span>
            <span>4 分钟阅读</span>
            <span id="views-separator" style="display: none">•</span>
            <span id="page-views" style="display: none"></span>
        </div>
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-6 leading-tight">Hugo博客搭建教程以及配置调优</h1>
        
        <p class="text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-2xl mx-auto">Hugo是一个基于Golang的静态博客，相比于Nodejs的Hexo构建效率提升600%，同时也支持低JavaScript特性，SEO更加优化，爬虫更易获取</p>
        
        
        <div class="w-full rounded-2xl overflow-hidden shadow-sm mb-8">
            <img src="&#x2F;img&#x2F;101221e3bb5e273f18e3fae2e80d6803.webp" alt="Hugo博客搭建教程以及配置调优" class="w-full h-auto">
        </div>
        
    </header>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const baseUrl = 'https://umami.acofork.com';
                const shareId = 'CdkXbGgZr6ECKOyK';
                // Current page path
                const urlPath = window.location.pathname;
                
                const stats = await window.fetchUmamiStats(baseUrl, shareId, {
                    url: urlPath
                });
                
                // Check for both 'visits' (new preference) or 'pageviews' (fallback)
                const metric = (stats && (stats.visits || stats.pageviews));
                
                let views = 0;
                let hasData = false;

                if (metric && typeof metric.value !== 'undefined') {
                    views = metric.value;
                    hasData = true;
                } else if (stats && (typeof stats.visits === 'number' || typeof stats.pageviews === 'number')) {
                        // Fallback for flat structure
                        views = stats.visits || stats.pageviews;
                        hasData = true;
                }

                if (hasData) {
                    const viewEl = document.getElementById('page-views');
                    viewEl.textContent = views + ' 次访问';
                    viewEl.style.display = 'inline';
                    document.getElementById('views-separator').style.display = 'inline';
                }
            } catch (e) {
                console.error('Failed to load page views:', e);
            }
        });
    </script>

    <!-- Post Content -->
    <article class="prose prose-lg dark:prose-invert max-w-none bg-white dark:bg-gray-800 p-8 md:p-12 rounded-2xl shadow-sm">
        <h1 id="引言">引言</h1>
<p>曾经我写过一篇文章叫做：<a href="/posts/fuwari/">Fuwari静态博客搭建教程</a>。</p>
<p>文中的<a rel="noopener nofollow" target="_blank" href="https://github.com/saicaca/fuwari">Fuwari</a>是基于Astro的，并且使用了服务器+客户端的混合渲染，尽管UI确实好看，但因为本人不会写Astro导致日后维护特别困难（比如手动添加Giscus评论后和上游分支发生冲突需要手动解决冲突才能合并上游）。</p>
<p>最后我放弃了，既然我就是菜我为什么不找一个原生使用HTML+JS+CSS的框架呢？</p>
<p>于是我便询问AI，Claude推荐我使用Hugo。</p>
<p>其实我早就曾听闻Hugo的大名，但是并没有深入研究，但是Claude又告诉我Hugo采用Go语言进行编译，速度快，而且想要二次开发也只需要改改我最熟悉的HTML+JS+CSS。</p>
<p>于是我便花了2小时深入研究、部署、调优。发现Hugo确实很强大：迁移方便，二改简单，构建迅速</p>
<h1 id="正式开始">正式开始</h1>
<blockquote>
<p>请全程在Windows上操作</p>
</blockquote>
<p>我们首先需要安装Scoop，这是一个适用于Windows的包管理器，个人认为非常好用</p>
<p>Scoop默认会安装到C盘，如果你想要换盘请按需更改</p>
<pre data-lang="powershell" class="language-powershell "><code class="language-powershell" data-lang="powershell">$env:SCOOP=&#x27;D:\Scoop&#x27;
$env:SCOOP_GLOBAL=&#x27;D:\ScoopApps&#x27;
[Environment]::SetEnvironmentVariable(&#x27;SCOOP&#x27;, $env:SCOOP, &#x27;User&#x27;)
[Environment]::SetEnvironmentVariable(&#x27;SCOOP_GLOBAL&#x27;, $env:SCOOP_GLOBAL, &#x27;Machine&#x27;)
</code></pre>
<p>安装Scoop：</p>
<pre data-lang="powershell" class="language-powershell "><code class="language-powershell" data-lang="powershell">Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
Invoke-RestMethod -Uri https:&#x2F;&#x2F;get.scoop.sh | Invoke-Expression
</code></pre>
<p>如果你以管理员的身份会安装失败，请切换为普通用户。若想强制以管理员身份安装Scoop请使用</p>
<p><a rel="noopener nofollow" target="_blank" href="https://github.com/ScoopInstaller/Install#for-admin">github原帖</a></p>
<p>出于安全考虑，默认情况下已禁用管理员控制台下的安装。如果您知道自己在做什么并希望以管理员身份安装Scoop，请下载安装程序并在提升的控制台中手动执行它，使用 <code>-RunAsAdmin</code> 参数。以下是示例：</p>
<pre data-lang="powershell" class="language-powershell "><code class="language-powershell" data-lang="powershell">irm get.scoop.sh -outfile &#x27;install.ps1&#x27;
.\install.ps1 -RunAsAdmin [-OtherParameters ...]
# 如果你想要一行解决：
iex &quot;&amp; {$(irm get.scoop.sh)} -RunAsAdmin&quot;
</code></pre>
<p>安装Hugo框架：</p>
<pre data-lang="powershell" class="language-powershell "><code class="language-powershell" data-lang="powershell">scoop install hugo
</code></pre>
<p>然后选择一个你喜欢的文件夹创建你的站点。 <code>myblog</code> 即你的站点文件夹名称</p>
<pre data-lang="shell" class="language-shell "><code class="language-shell" data-lang="shell">hugo new site myblog
cd myblog
</code></pre>
<p>安装PaperMod主题：</p>
<pre data-lang="shell" class="language-shell "><code class="language-shell" data-lang="shell">git clone https:&#x2F;&#x2F;github.com&#x2F;adityatelange&#x2F;hugo-PaperMod.git themes&#x2F;PaperMod
</code></pre>
<p>站点根目录会有一个 <code>hugo.toml</code>。我推荐使用YAML。将文件重命名为 <code>hugo.yaml</code>。粘贴并更改以下内容</p>
<pre data-lang="yaml" class="language-yaml "><code class="language-yaml" data-lang="yaml">baseURL: &quot;https:&#x2F;&#x2F;站点url&quot;
title: &quot;网站标题&quot;
LanguageCode: &quot;zh-CN&quot;
theme: &quot;PaperMod&quot;

# 启用首页个人简介展示
params:
  # 是否启用评论。你需要自己配置，或者直接引入Giscus等评论系统
  comments: false
  # 是否显示代码复制按钮
  ShowCodeCopyButtons: true
  # 是否显示面包屑导航
  ShowBreadCrumbs: false
  # 是否显示阅读时间  
  ShowReadingTime: true
  # 是否显示分享按钮
  ShowShareButtons: true
  # 分享按钮配置
  # ShareButtons: [&quot;linkedin&quot;, &quot;twitter&quot;]
  # 是否禁用主题切换按钮
  disableThemeToggle: false
  assets:
    favicon: &quot;&#x2F;你的&#x2F;网站图标.jpg&quot; # 需要在static文件夹放置对应的图片
    iconHeight: 35
  # 首页信息配置
  homeInfoParams:
    Title: &quot;首页展示的标题&quot;
    Content: &gt;
      首页展示的文本

  # 设置网站头像和首页头像
  profileMode:
    enabled: false # 设为 true 将完全替换 homeInfoParams

  # 网站头像设置 (显示在导航栏)
  label:
    text: &quot;左上角显示的文本&quot;
    icon: &quot;&#x2F;你的&#x2F;左上角显示的图片.jpg&quot; # 这将显示在导航栏标题旁边。需要在static文件夹放置对应的图片
    iconHeight: 35

  # 社交图标 (显示在简介下方)
  socialIcons:
    - name: bilibili
      url: &quot;&quot;
    - name: github
      url: &quot;&quot;
    - name: telegram
      url: &quot;&quot;
    # 可以添加更多社交图标 https:&#x2F;&#x2F;github.com&#x2F;adityatelange&#x2F;hugo-PaperMod&#x2F;wiki&#x2F;Icons

# 顶部导航栏的快捷链接
menu:
  main:
    - identifier: categories
      name: 分类
      url: &#x2F;categories&#x2F;
      weight: 10
    - identifier: tags
      name: 标签
      url: &#x2F;tags&#x2F;
      weight: 20
    - identifier: archives
      name: 归档
      url: &#x2F;archives&#x2F;
      weight: 30
    - identifier: search
      name: 搜索
      url: &#x2F;search&#x2F;
      weight: 40
    # 可以添加更多导航链接。weight的值越高排序越靠后

# 如果要启用搜索功能，需要添加这个
outputs:
  home:
    - HTML
    - RSS
    - JSON # 必须，用于搜索功能
</code></pre>
<p>然后我们需要分别配置分类、标签、归档和搜索页</p>
<p>创建 <code>content\categories\_index.md</code> 写入：</p>
<pre data-lang="markdown" class="language-markdown "><code class="language-markdown" data-lang="markdown">---
title: 分类
layout: categories
---
</code></pre>
<p>创建 <code>content\tags\_index.md</code> 写入：</p>
<pre data-lang="markdown" class="language-markdown "><code class="language-markdown" data-lang="markdown">---
title: 标签
layout: tags
---
</code></pre>
<p>创建 <code>content\archives.md</code> 写入：</p>
<pre data-lang="markdown" class="language-markdown "><code class="language-markdown" data-lang="markdown">---
title: 归档
layout: archives
---
</code></pre>
<p>创建 <code>content\search.md</code> 写入：</p>
<pre data-lang="markdown" class="language-markdown "><code class="language-markdown" data-lang="markdown">---
title: &quot;搜索&quot;
layout: &quot;search&quot;
---
</code></pre>
<p>然后我们要更改默认的文章创建模板</p>
<p>在 <code>archetypes\default.md</code> 写入：</p>
<pre data-lang="markdown" class="language-markdown "><code class="language-markdown" data-lang="markdown">---
title: {{ replace .File.ContentBaseName &quot;-&quot; &quot; &quot; | title }}
published: {{ .Date }}
summary: &quot;文章简介&quot;
cover:
  image: 文章封面图。也支持HTTPS
tags: [标签1, 标签2]
draft: false 
lang: &#x27;&#x27;
---
</code></pre>
<p>接下来我们就可以通过命令来创建文章，并开始写作了。注意，最终构建的文章URL是你的文章的文件名。比如：<code>https://你的网站.com/posts/first</code> 所以文章文件名尽量简短，这并不会影响你的文章标题</p>
<pre data-lang="shell" class="language-shell "><code class="language-shell" data-lang="shell">hugo new posts&#x2F;first.md
</code></pre>
<p>当我们写完一篇文章想要预览网站，可以使用</p>
<pre data-lang="powershell" class="language-powershell "><code class="language-powershell" data-lang="powershell">hugo server
</code></pre>
<p>当我们想要将站点发布到Vercel、Cloudflare Pages等静态网站托管平台可以将我们的 <code>myblog</code> 作为一个Git存储库提交到Github</p>
<p>根目录：<code>./</code></p>
<p>输出目录：<code>public</code></p>
<p>构建命令：<code>hugo --gc</code></p>
<p>环境变量： Key：<code>HUGO_VERSION</code> Value：<code>0.145.0</code></p>
<hr />
<h3 id="对象存储存图中间件代码：">对象存储存图中间件代码：</h3>
<pre data-lang="python" class="language-python "><code class="language-python" data-lang="python">import keyboard
import pyperclip
from PIL import ImageGrab, Image
import io
import boto3
from botocore.config import Config
import time
import uuid
import pyautogui
import os
from io import BytesIO
# 示例配置
# # R2 配置
# R2_CONFIG = {
#     &#x27;account_id&#x27;: &#x27;11111111111111111&#x27;,
#     &#x27;access_key_id&#x27;: &#x27;11111111111111111&#x27;,
#     &#x27;secret_access_key&#x27;: &#x27;11111111111111111&#x27;,
#     &#x27;bucket_name&#x27;: &#x27;11111111111111111&#x27;
# }

# # OSS 配置
# OSS_CONFIG = {
#     &#x27;url&#x27;: &#x27;sb-eo-r2.2x.nz&#x27;,
#     &#x27;prefix&#x27;: &#x27;&#x2F;fuwari-blog&#x2F;img&#x27;
# }
#########################################################
# R2 配置
R2_CONFIG = {
    &#x27;account_id&#x27;: &#x27;&#x27;,
    &#x27;access_key_id&#x27;: &#x27;&#x27;,
    &#x27;secret_access_key&#x27;: &#x27;&#x27;,
    &#x27;bucket_name&#x27;: &#x27;&#x27;
}

# OSS 配置
OSS_CONFIG = {
    &#x27;url&#x27;: &#x27;&#x27;,
    &#x27;prefix&#x27;: &#x27;&#x27;
}
#########################################################
def init_r2_client():
    &quot;&quot;&quot;初始化 R2 客户端&quot;&quot;&quot;
    return boto3.client(
        &#x27;s3&#x27;,
        endpoint_url=f&#x27;https:&#x2F;&#x2F;{R2_CONFIG[&quot;account_id&quot;]}.r2.cloudflarestorage.com&#x27;,
        aws_access_key_id=R2_CONFIG[&#x27;access_key_id&#x27;],
        aws_secret_access_key=R2_CONFIG[&#x27;secret_access_key&#x27;],
        config=Config(signature_version=&#x27;s3v4&#x27;),
        region_name=&#x27;auto&#x27;
    )

def get_image_from_clipboard():
    &quot;&quot;&quot;从剪贴板获取图片&quot;&quot;&quot;
    try:
        image = ImageGrab.grabclipboard()
        if image is None:
            return None

        # 如果是列表（多个文件），取第一个
        if isinstance(image, list):
            if len(image) &gt; 0:
                # 如果是图片文件路径，打开它
                try:
                    return Image.open(image[0])
                except Exception as e:
                    print(f&quot;打开图片文件失败: {e}&quot;)
                    return None
            return None

        # 如果直接是 Image 对象
        if isinstance(image, Image.Image):
            return image

        return None
    except Exception as e:
        print(f&quot;获取剪贴板图片失败: {e}&quot;)
        return None

def convert_to_webp(image):
    &quot;&quot;&quot;将图片转换为 webp 格式&quot;&quot;&quot;
    if not image:
        return None

    try:
        buffer = BytesIO()
        # 确保图片是 RGB 模式
        if image.mode in (&#x27;RGBA&#x27;, &#x27;LA&#x27;):
            background = Image.new(&#x27;RGB&#x27;, image.size, (255, 255, 255))
            background.paste(image, mask=image.split()[-1])
            image = background
        elif image.mode != &#x27;RGB&#x27;:
            image = image.convert(&#x27;RGB&#x27;)

        image.save(buffer, format=&quot;WEBP&quot;, quality=80)
        return buffer.getvalue()
    except Exception as e:
        print(f&quot;转换图片失败: {e}&quot;)
        return None

def upload_to_r2(image_data):
    &quot;&quot;&quot;上传图片到 R2&quot;&quot;&quot;
    if not image_data:
        return None

    client = init_r2_client()

    # 生成基础文件名
    base_filename = f&quot;{uuid.uuid4()}.webp&quot;
    filename = base_filename

    try:
        # 检查文件是否已存在
        attempt = 1
        while True:
            try:
                # 尝试获取文件信息，如果文件存在会返回数据，不存在会抛出异常
                client.head_object(
                    Bucket=R2_CONFIG[&#x27;bucket_name&#x27;],
                    Key=f&quot;{OSS_CONFIG[&#x27;prefix&#x27;].strip(&#x27;&#x2F;&#x27;)}&#x2F;{filename}&quot;
                )
                # 如果文件存在，修改文件名
                name_without_ext = base_filename.rsplit(&#x27;.&#x27;, 1)[0]
                filename = f&quot;{name_without_ext}_{attempt}.webp&quot;
                attempt += 1
                print(f&quot;文件名已存在，尝试重命名为: {filename}&quot;)
            except client.exceptions.ClientError as e:
                # 如果是 404 错误，说明文件不存在，可以使用这个文件名
                if e.response[&#x27;Error&#x27;][&#x27;Code&#x27;] == &#x27;404&#x27;:
                    break
                raise e  # 其他错误则抛出

        # 上传文件
        client.put_object(
            Bucket=R2_CONFIG[&#x27;bucket_name&#x27;],
            Key=f&quot;{OSS_CONFIG[&#x27;prefix&#x27;].strip(&#x27;&#x2F;&#x27;)}&#x2F;{filename}&quot;,
            Body=image_data,
            ContentType=&#x27;image&#x2F;webp&#x27;
        )
        return filename
    except Exception as e:
        print(f&quot;上传失败: {e}&quot;)
        return None

def generate_markdown_link(filename):
    &quot;&quot;&quot;生成 Markdown 图片链接&quot;&quot;&quot;
    if not filename:
        return None

    url = f&quot;https:&#x2F;&#x2F;{OSS_CONFIG[&#x27;url&#x27;]}{OSS_CONFIG[&#x27;prefix&#x27;]}&#x2F;{filename}&quot;
    return f&quot;![]({url})&quot;

def type_markdown_link(markdown_link):
    &quot;&quot;&quot;模拟键盘输入 Markdown 链接&quot;&quot;&quot;
    if not markdown_link:
        return

    pyperclip.copy(markdown_link)
    pyautogui.hotkey(&#x27;ctrl&#x27;, &#x27;v&#x27;)

def handle_upload():
    &quot;&quot;&quot;处理图片上传的主函数&quot;&quot;&quot;
    print(f&quot;\n[{time.strftime(&#x27;%Y-%m-%d %H:%M:%S&#x27;)}] 收到粘贴请求&quot;)

    print(&quot;正在检查剪贴板...&quot;)
    # 获取剪贴板图片
    image = get_image_from_clipboard()
    if not image:
        print(&quot;❌ 剪贴板中没有图片&quot;)
        return
    print(&quot;✅ 获取到剪贴板图片&quot;)

    # 转换为 webp
    print(&quot;正在转换为 WebP 格式...&quot;)
    image_data = convert_to_webp(image)
    if not image_data:
        print(&quot;❌ 图片转换失败&quot;)
        return
    print(f&quot;✅ 转换完成，大小: {len(image_data)&#x2F;1024:.2f}KB&quot;)

    # 上传到 R2
    print(&quot;正在上传到 R2...&quot;)
    filename = upload_to_r2(image_data)
    if not filename:
        print(&quot;❌ 上传失败&quot;)
        return
    print(f&quot;✅ 上传成功，文件名: {filename}&quot;)

    # 生成并输入 Markdown 链接
    markdown_link = generate_markdown_link(filename)
    if markdown_link:
        print(f&quot;生成的 URL: https:&#x2F;&#x2F;{OSS_CONFIG[&#x27;url&#x27;]}{OSS_CONFIG[&#x27;prefix&#x27;]}&#x2F;{filename}&quot;)
        print(f&quot;模拟键入: {markdown_link}&quot;)
        type_markdown_link(markdown_link)
        print(&quot;✅ 操作完成&quot;)

def main():
    &quot;&quot;&quot;主函数&quot;&quot;&quot;
    print(&quot;=&quot; * 50)
    print(&quot;R2 图片上传插件已启动&quot;)
    print(f&quot;当前配置:&quot;)
    print(f&quot;- OSS 域名: {OSS_CONFIG[&#x27;url&#x27;]}&quot;)
    print(f&quot;- 存储路径: {OSS_CONFIG[&#x27;prefix&#x27;]}&quot;)
    print(f&quot;- R2 存储桶: {R2_CONFIG[&#x27;bucket_name&#x27;]}&quot;)
    print(&quot;使用 Ctrl+Alt+V 上传剪贴板中的图片&quot;)
    print(&quot;=&quot; * 50)

    # 注册快捷键
    keyboard.add_hotkey(&#x27;ctrl+alt+v&#x27;, handle_upload)

    # 保持程序运行
    keyboard.wait()

if __name__ == &quot;__main__&quot;:
    main() 
</code></pre>

    </article>

    <!-- License -->
    <div class="mt-8 p-6 bg-gray-50 dark:bg-gray-700/50 rounded-2xl text-sm text-gray-600 dark:text-gray-400">
        <div class="flex flex-col gap-2">
            <p class="font-medium text-gray-900 dark:text-white">版权声明</p>
            <p>
                本文由 <span class="font-medium">二叉树树</span> 创作，采用 
                <a href="https:&#x2F;&#x2F;creativecommons.org&#x2F;licenses&#x2F;by-nc-sa&#x2F;4.0&#x2F;" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline">CC BY-NC-SA 4.0</a> 
                许可协议。
            </p>
            <p>
                转载请注明出处：<a href="https:&#x2F;&#x2F;blog.acofork.com&#x2F;posts&#x2F;hugo&#x2F;" class="text-blue-600 dark:text-blue-400 hover:underline break-all">AcoFork Blog - Hugo博客搭建教程以及配置调优: https:&#x2F;&#x2F;blog.acofork.com&#x2F;posts&#x2F;hugo&#x2F;</a>
            </p>
        </div>
    </div>

    <!-- Help & Edit -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-sm">
            <h3 class="font-bold text-gray-900 dark:text-white mb-2">这篇文章是否对你有帮助？</h3>
            <div class="flex space-x-4">
                <a href="&#x2F;posts&#x2F;pin" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">联系</a>
                <a href="&#x2F;sponsors" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">赞助</a>
            </div>
        </div>
        <div class="p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-sm">
            <h3 class="font-bold text-gray-900 dark:text-white mb-2">发现错误或想要改进这篇文章？</h3>
            <a href="https:&#x2F;&#x2F;github.com&#x2F;afoim&#x2F;AcoFork_Blog_Zola/blob/main/content/posts&#x2F;hugo.md" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline flex items-center">
                <span>在 GitHub 上编辑此页</span>
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
            </a>
        </div>
    </div>

    <!-- Post Footer -->
    <footer class="mt-8 flex flex-wrap gap-2 justify-center">
        
        
        <a href="https://blog.acofork.com/tags/hugo/" class="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-full text-sm hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">#Hugo</a>
        
        
    </footer>

    <!-- Comments (Giscus) -->
    <div class="mt-12 bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-sm">
<script src="https://giscus.app/client.js"
        data-repo="afoim/giscus-fuwari"
        data-repo-id="R_kgDOOi8quw"
        data-category="Announcements"
        data-category-id="DIC_kwDOOi8qu84CprDV"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>
    </div>
</div>

    </main>

    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col items-center justify-center space-y-2">
                <p class="text-gray-500 dark:text-gray-400 text-sm">
                    &copy; 2026 二叉树树. 
                    <a href="https:&#x2F;&#x2F;creativecommons.org&#x2F;licenses&#x2F;by-nc-sa&#x2F;4.0&#x2F;" target="_blank" class="hover:underline">CC BY-NC-SA 4.0</a>
                </p>
                <p class="text-gray-400 dark:text-gray-500 text-xs">
                    Powered by <a href="https://www.getzola.org" target="_blank" class="hover:text-gray-300">Zola</a>
                     · <a href="https://github.com/afoim/AcoFork_Blog_Zola" target="_blank" class="hover:text-gray-300">Source Code</a>
                </p>
                <a href="https://blog.acofork.com/rss.xml" target="_blank" class="text-gray-400 hover:text-orange-500 dark:hover:text-orange-400 transition-colors p-2">
                    <span class="sr-only">RSS</span>
                    <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <path d="M5 3a1 1 0 000 2c5.523 0 10 4.477 10 10a1 1 0 102 0C17 8.373 11.627 3 5 3z"></path>
                        <path d="M4 9a1 1 0 011-1 7 7 0 017 7 1 1 0 11-2 0 5 5 0 00-5-5 1 1 0 01-1-1zM3 15a2 2 0 114 0 2 2 0 01-4 0z"></path>
                    </svg>
                </a>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
    <script src="/js/umami-share.js"></script>
    <script src="/js/search.js"></script>
    <script src="/js/gfm-alerts.js"></script>
    <script src="/js/anchor-fix.js"></script>
    <script>
        // Umami script needs to be loaded if it's not already
        // This is a workaround since we removed the original script tag
        (function() {
            var el = document.createElement('script');
            el.setAttribute('src', 'https://umami.acofork.com/script.js');
            el.setAttribute('data-website-id', '5d710dbd-3a2e-43e3-a553-97b415090c63');
            el.setAttribute('defer', '');
            document.body.appendChild(el);
        })();
    </script>
</body>
</html>
