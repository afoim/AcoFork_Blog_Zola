<!DOCTYPE html>
<html lang="zh" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cloudflare-imgbed项目使用Action自动备份元数据到仓库 - AcoFork Blog</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css"/>
    <link rel="icon" href="https://q2.qlogo.cn/headimg_dl?dst_uin=2726730791&amp;spec=0">
    <script src="https://pic1.acofork.com/random.js"></script>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.acofork.com/rss.xml">
    <script src="/js/main.js"></script>
</head>
<body class="bg-[var(--page-bg)] text-gray-900 dark:text-gray-100 transition-colors duration-300 min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md shadow-sm dark:border-b dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <a href="/" class="text-xl font-bold text-blue-600 dark:text-blue-400">AcoFork Blog</a>
                    </div>
                    <!-- Desktop Menu -->
                    <div class="hidden md:ml-6 md:flex md:space-x-8">
                        
                        <a href="&#x2F;" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           >
                            首页
                        </a>
                        
                        <a href="&#x2F;posts" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           >
                            归档
                        </a>
                        
                        <a href="&#x2F;friends" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           >
                            友链
                        </a>
                        
                        <a href="&#x2F;sponsors" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           >
                            赞助
                        </a>
                        
                        <a href="https:&#x2F;&#x2F;umami.acofork.com&#x2F;share&#x2F;CdkXbGgZr6ECKOyK" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           target="_blank">
                            统计
                        </a>
                        
                        <a href="https:&#x2F;&#x2F;status.acofork.com" 
                           class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-300 dark:hover:text-white dark:hover:border-gray-600 transition duration-150 ease-in-out"
                           target="_blank">
                            监控
                        </a>
                        
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Mobile Menu Button -->
                    <button type="button" onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                        <span class="sr-only">Open menu</span>
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <!-- Search Button -->
                    <button onclick="toggleSearch()" class="p-2 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                    <!-- Theme Toggle -->
                    <button onclick="toggleTheme()" class="p-2 text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                        <svg id="sun-icon" class="h-6 w-6 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <svg id="moon-icon" class="h-6 w-6 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
            <div class="px-2 pt-2 pb-3 space-y-1">
                
                <a href="&#x2F;" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   >
                    首页
                </a>
                
                <a href="&#x2F;posts" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   >
                    归档
                </a>
                
                <a href="&#x2F;friends" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   >
                    友链
                </a>
                
                <a href="&#x2F;sponsors" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   >
                    赞助
                </a>
                
                <a href="https:&#x2F;&#x2F;umami.acofork.com&#x2F;share&#x2F;CdkXbGgZr6ECKOyK" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   target="_blank">
                    统计
                </a>
                
                <a href="https:&#x2F;&#x2F;status.acofork.com" 
                   class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 hover:bg-gray-50 dark:hover:bg-gray-700"
                   target="_blank">
                    监控
                </a>
                
            </div>
        </div>
    </nav>

    <!-- Search Modal -->
    <div id="search-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="toggleSearch()"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto p-4 sm:p-6 md:p-20" onclick="if(event.target === this) toggleSearch()">
            <div class="mx-auto max-w-xl transform rounded-xl bg-white dark:bg-gray-800 p-2 shadow-2xl transition-all">
                <input type="text" id="search-input" 
                       class="w-full rounded-md border-0 bg-gray-100 dark:bg-gray-700 px-4 py-2.5 text-gray-900 dark:text-white placeholder-gray-500 focus:ring-0 sm:text-sm" 
                       placeholder="搜索文章..." autocomplete="off">
                <ul id="search-results" class="max-h-96 scroll-py-3 overflow-y-auto p-3"></ul>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
<div class="max-w-4xl mx-auto">
    <!-- Post Header -->
    <header class="mb-8 text-center">
        <div class="flex items-center justify-center space-x-2 text-sm text-gray-500 dark:text-gray-400 mb-4">
            <time datetime="2025-08-21">2025-08-21</time>
            <span>•</span>
            <span>14 分钟阅读</span>
            <span id="views-separator" style="display: none">•</span>
            <span id="page-views" style="display: none"></span>
        </div>
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-6 leading-tight">cloudflare-imgbed项目使用Action自动备份元数据到仓库</h1>
        
        <p class="text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-2xl mx-auto">CloudFlare-ImgBed项目用基于GitHub Actions定期自动备份数据脚本</p>
        
        
        <div class="w-full rounded-2xl overflow-hidden shadow-sm mb-8">
            <img src="&#x2F;img&#x2F;dae7ab91ad6f1bcf325906c6bb22e041.png" alt="cloudflare-imgbed项目使用Action自动备份元数据到仓库" class="w-full h-auto">
        </div>
        
    </header>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const baseUrl = 'https://umami.acofork.com';
                const shareId = 'CdkXbGgZr6ECKOyK';
                // Current page path
                const urlPath = window.location.pathname;
                
                const stats = await window.fetchUmamiStats(baseUrl, shareId, {
                    url: urlPath
                });
                
                // Check for both 'visits' (new preference) or 'pageviews' (fallback)
                const metric = (stats && (stats.visits || stats.pageviews));
                
                let views = 0;
                let hasData = false;

                if (metric && typeof metric.value !== 'undefined') {
                    views = metric.value;
                    hasData = true;
                } else if (stats && (typeof stats.visits === 'number' || typeof stats.pageviews === 'number')) {
                        // Fallback for flat structure
                        views = stats.visits || stats.pageviews;
                        hasData = true;
                }

                if (hasData) {
                    const viewEl = document.getElementById('page-views');
                    viewEl.textContent = views + ' 次访问';
                    viewEl.style.display = 'inline';
                    document.getElementById('views-separator').style.display = 'inline';
                }
            } catch (e) {
                console.error('Failed to load page views:', e);
            }
        });
    </script>

    <!-- Post Content -->
    <article class="prose prose-lg dark:prose-invert max-w-none bg-white dark:bg-gray-800 p-8 md:p-12 rounded-2xl shadow-sm">
        <blockquote>
<p>本文由 <a rel="noopener nofollow" target="_blank" href="https://github.com/afoim/fuwari/pull/40">https://github.com/afoim/fuwari/pull/40</a> 提供，非站长原创</p>
</blockquote>
<p><a rel="noopener nofollow" target="_blank" href="https://github.com/yunsen2025/cloudflare-imgbed-auto-backup"><a rel="noopener nofollow" target="_blank" href="https://github.com/yunsen2025/cloudflare-imgbed-auto-backup">https://github.com/yunsen2025/cloudflare-imgbed-auto-backup</a></a>
<a rel="noopener nofollow" target="_blank" href="https://github.com/MarSeventh/CloudFlare-ImgBed">CloudFlare-ImgBed项目</a>用基于GitHub Actions定期自动备份数据脚本</p>
<blockquote>
<p>[!IMPORTANT]</p>
<h2 id="🚨_重要安全提醒_🚨">🚨 重要安全提醒 🚨</h2>
<p><strong>⚠️ 在备份文件中包含重要的敏感信息数据！</strong></p>
<ul>
<li>为了保护您的数据安全，程序内置了仓库隐私检查功能：</li>
<li>每次运行前自动检查仓库是否为 <strong>私有</strong> ；</li>
<li>因此，在使用本项目前请确保您已将仓库<strong>解除复刻网络</strong>并更改为<strong>私有</strong></li>
<li>如果仓库为公开状态，程序将拒绝执行并显示安全警告<br />
<strong>步骤：你的仓库➡Settings➡General➡（划到最下面）Danger➡Leave fork network➡Change repository visibility</strong><br />
(其实公开仓库不会执行actions)</li>
</ul>
</blockquote>
<h2 id="功能特性">功能特性</h2>
<ul>
<li>🕒 <strong>定时备份</strong>: 每天UTC+8的2：00自动执行备份任务</li>
<li>🔐 <strong>安全认证</strong>: 通过仓库机密统一管理</li>
<li>🛡️ <strong>隐私保护</strong>: 强制检查仓库隐私状态，防止敏感数据泄露</li>
<li>📁 <strong>自动管理</strong>: 自动保存和管理备份文件</li>
<li>🚀 <strong>GitHub Actions</strong>: 完全基于GitHub Actions运行</li>
<li>🧹 <strong>自动清理</strong>: 自动清理旧备份文件（默认保留最近100个，可自定义）</li>
<li>🔍 <strong>智能检测</strong>: 通过MD5自动检测数据变化，只在有变更时保存备份</li>
</ul>
<h2 id="快速开始">快速开始</h2>
<p>请确保你的cloudflare-imgbed版本大于V2.0.3</p>
<h3 id="1._🔒_确保仓库为私有">1. 🔒 确保仓库为私有</h3>
<p><strong>重要：请务必确保您的仓库设置为私有（Private）状态！</strong></p>
<ol>
<li>前往您的GitHub仓库主页</li>
<li>点击 <code>Settings</code> 选项卡</li>
<li>滚动到页面底部的 <code>Danger Zone</code> 区域</li>
<li>点击 <code>Leave fork network</code> 将你的仓库脱离复刻网络
<img src="/img/c1cd525fde736d01b166935a31d2b6c5.png" alt="alt text" /></li>
<li>点击 <code>Change repository visibility</code> 选择 <code>Make private</code> 将仓库设为私有
<img src="/img/b521dacfe266373e9dcd3f0b67315eb0.png" alt="alt text" /></li>
</ol>
<h3 id="2._配置GitHub仓库机密">2. 配置GitHub仓库机密</h3>
<p>在你的GitHub仓库中，进入 <code>Settings</code> -&gt; <code>Secrets and variables</code> -&gt; <code>Actions</code>，添加以下机密：
<img src="/img/48002efbb8d41a7b8661c30df3269c53.png" alt="alt text" />
<strong>必需配置</strong>:</p>
<table><thead><tr><th>机密名称</th><th>说明</th><th>示例值</th></tr></thead><tbody>
<tr><td><code>BACKUP_URL</code></td><td>网站完整URL（包含协议和端口）</td><td><code>cfbed.1314883.xyz</code></td></tr>
<tr><td><code>BACKUP_USERNAME</code></td><td>登录用户名（BASIC_USER）</td><td><code>your_username</code></td></tr>
<tr><td><code>BACKUP_PASSWORD</code></td><td>登录密码（BASIC_PASS）</td><td><code>your_password</code></td></tr>
</tbody></table>
<p><strong>可选配置</strong> (不设置将使用默认值):</p>
<table><thead><tr><th>机密名称</th><th>说明</th><th>示例值</th><th>默认值</th></tr></thead><tbody>
<tr><td><code>MAX_BACKUPS</code></td><td>最大保留备份文件数量</td><td><code>1145</code></td><td><code>100</code></td></tr>
<tr><td><code>ENABLE_CHANGE_DETECTION</code></td><td>启用智能变更检测</td><td><code>true/false</code></td><td><code>true</code></td></tr>
</tbody></table>
<h3 id="2._启用GitHub_Actions">2. 启用GitHub Actions</h3>
<p>确保你的仓库已启用GitHub Actions功能。</p>
<p><strong>注意</strong>: 程序会自动将你提供的URL拼接成完整的API路径：</p>
<ul>
<li>输入: <code>cfbed.1314883.xyz</code></li>
<li>自动拼接为: <code>https://cfbed.1314883.xyz/api/manage/sysConfig/backup?action=backup</code></li>
<li>支持 HTTP 和 HTTPS 协议，会保持你指定的协议类型</li>
</ul>
<blockquote>
<p>[!IMPORTANT]<br />
如果你是http/非标准端口，请在变量中填完整的URL，如：<code>  &lt;http://cfbed.1314883.xyz:11451</code>&gt;<br />
默认拼接为https</p>
</blockquote>
<h3 id="3._执行备份">3. 执行备份</h3>
<p>备份程序会：</p>
<ul>
<li><strong>自动执行</strong>: 每天北京时间02:00自动运行</li>
<li><strong>手动触发</strong>: 你也可以在Actions页面手动触发备份
如果您是第一次部署本项目，请在Action中手动执行一次确保执行正常
<img src="/img/d0091f6158bddd1817fd8bf1121e9403.png" alt="alt text" />
正确输出：<br />
<img src="/img/dae7ab91ad6f1bcf325906c6bb22e041.png" alt="正确输出" /></li>
</ul>
<h2 id="文件结构">文件结构</h2>
<pre><code>cloudflare-imgbed-auto-backup&#x2F;
├── .github&#x2F;
│   └── workflows&#x2F;
│       └── backup.yml          # GitHub Actions工作流配置
├── backups&#x2F;                    # 备份文件存储目录
│   ├──.privacy_verified        # 安全性证明文件
│   ├── backup_20240816_100000.json
│   ├── backup_20240817_100000.json
│   └── latest_backup.json      # 最新备份文件
├── backup_script.py            # 主备份脚本
├── requirements.txt            # Python依赖
└── README.md                   # 说明文档
</code></pre>
<h2 id="备份文件说明">备份文件说明</h2>
<ul>
<li><strong>带时间标志的备份文件</strong>: <code>backup_YYYYMMDD_HHMMSS.json</code></li>
<li><strong>最新备份文件</strong>: <code>latest_backup.json</code> (始终指向最新的备份)</li>
<li><strong>自动清理</strong>: 程序会自动保留最近的指定数量个备份文件（默认100个）</li>
</ul>
<h2 id="🔍_智能变更检测">🔍 智能变更检测</h2>
<p>程序默认启用智能变更检测功能，只有在数据发生变化时才会保存新的备份文件：</p>
<h3 id="检测原理">检测原理</h3>
<ul>
<li>使用MD5哈希算法计算JSON数据的指纹</li>
<li>将新下载的数据与最新备份文件进行对比</li>
<li>只有当哈希值不同时才保存新的备份文件</li>
</ul>
<h3 id="优势">优势</h3>
<ul>
<li><strong>节省存储空间</strong>: 避免保存重复的备份文件</li>
<li><strong>减少提交噪音</strong>: GitHub仓库不会产生无意义的提交</li>
<li><strong>提高效率</strong>: 跳过无变化的备份操作</li>
</ul>
<h3 id="控制选项">控制选项</h3>
<ul>
<li><strong>启用</strong>: <code>ENABLE_CHANGE_DETECTION=true</code> （默认）</li>
<li><strong>禁用</strong>: <code>ENABLE_CHANGE_DETECTION=false</code> （强制每次都备份）</li>
</ul>
<h3 id="特殊情况处理">特殊情况处理</h3>
<ul>
<li><strong>首次备份</strong>: 没有历史数据时，总是保存备份</li>
<li><strong>计算错误</strong>: 无法计算哈希时，为安全起见会强制保存备份</li>
<li><strong>文件缺失</strong>: 找不到最新备份文件时，会保存新的备份</li>
</ul>
<h2 id="🛡️_仓库隐私保护功能">🛡️ 仓库隐私保护功能</h2>
<p>为了防止敏感数据泄露，程序内置了强制的仓库隐私检查功能。
<a rel="noopener nofollow" target="_blank" href="https://github.com/yunsen2025/cloudflare-imgbed-auto-backup/blob/main/SECURITY_FEATURES.md">详见</a></p>
<ul>
<li><strong>强制执行，无配置选项可以禁用此功能</strong></li>
</ul>
<h3 id="常见问题">常见问题</h3>
<p><strong>Q: 为什么需要这个功能？</strong><br />
A: 在导出的JSON文件中，包含TG变量与S3端点信息等，属于十分敏感的信息，为安全起见，本项目仅允许私有仓库使用。公开仓库会让任何人都能访问这些数据，造成严重的安全风险。</p>
<p><strong>Q: 可以禁用这个检查吗？</strong><br />
A: 不可以。为了确保数据安全，此功能强制执行，无法禁用。</p>
<p><strong>Q: 检查失败了怎么办？</strong><br />
A: 按照错误提示将仓库设置为私有，然后重新运行备份任务。程序会自动重新检查。如还有错误请提起<a rel="noopener nofollow" target="_blank" href="https://github.com/yunsen2025/cloudflare-imgbed-auto-backup/issues">ISSUE</a>，请不要提交有关隐私的信息</p>
<h2 id="🌐_HTTP/HTTPS_协议支持">🌐 HTTP/HTTPS 协议支持</h2>
<p>程序支持 HTTP 和 HTTPS 两种协议，并能智能处理不同的网络环境：</p>
<h3 id="HTTP_协议特殊情况">HTTP 协议特殊情况</h3>
<h4 id="1._混合内容问题">1. <strong>混合内容问题</strong></h4>
<ul>
<li>在 GitHub Actions 环境中，HTTP 连接可能会受到安全策略限制</li>
<li>如果遇到连接问题，建议优先使用 HTTPS</li>
</ul>
<h4 id="2._端口配置">2. <strong>端口配置</strong></h4>
<ul>
<li>HTTP 默认端口：80</li>
<li>HTTPS 默认端口：443</li>
<li>自定义端口：如 <code>http://example.com:8080/</code></li>
<li>程序会保持你指定的端口号</li>
</ul>
<h4 id="3._SSL/TLS_证书问题">3. <strong>SSL/TLS 证书问题</strong></h4>
<ul>
<li>HTTP 连接不涉及证书验证</li>
<li>如果你的 HTTPS 使用自签名证书，可能需要特殊处理，懒得写这块了<del>也没人给图床用自签吧</del></li>
</ul>
<h4 id="4._连接超时设置">4. <strong>连接超时设置</strong></h4>
<ul>
<li>程序默认超时时间：30秒</li>
<li>对于较慢的服务器，可能需要调整超时时间</li>
</ul>
<h3 id="常见问题解决">常见问题解决</h3>
<ol>
<li>
<p><strong>“Connection refused” 错误</strong></p>
<pre data-lang="bash" class="language-bash "><code class="language-bash" data-lang="bash"># 检查服务是否运行
netstat -tulpn | grep 40968

# 检查防火墙状态
sudo ufw status
</code></pre>
</li>
<li>
<p><strong>“Certificate verify failed” 错误</strong></p>
<ul>
<li>这通常发生在 HTTPS 连接中</li>
<li>确保证书有效或使用 HTTP 协议</li>
</ul>
</li>
<li>
<p><strong>“Timeout” 错误</strong></p>
<ul>
<li>检查网络连接</li>
<li>确认服务器响应时间</li>
<li>考虑增加超时时间</li>
</ul>
</li>
</ol>
<h2 id="本地运行">本地运行</h2>
<p>如果你想在本地运行备份脚本：</p>
<ol>
<li>安装依赖：</li>
</ol>
<pre data-lang="bash" class="language-bash "><code class="language-bash" data-lang="bash">pip install -r requirements.txt
</code></pre>
<ol start="2">
<li>设置环境变量：</li>
</ol>
<pre data-lang="bash" class="language-bash "><code class="language-bash" data-lang="bash">export BACKUP_URL=&quot;http:&#x2F;&#x2F;&quot;
export BACKUP_USERNAME=&quot;your_username&quot;
export BACKUP_PASSWORD=&quot;your_password&quot;
export MAX_BACKUPS=&quot;100&quot;  # 可选，默认100
export ENABLE_CHANGE_DETECTION=&quot;true&quot;  # 可选，默认true

# 本地运行时需要设置以下变量进行隐私检查：
export GITHUB_TOKEN=&quot;your_github_token&quot;  # GitHub Personal Access Token
export GITHUB_REPOSITORY=&quot;username&#x2F;repo-name&quot;  # 仓库名称
</code></pre>
<p><strong>本地运行说明</strong>：</p>
<ul>
<li>本地运行时也会执行隐私检查，需要设置有效的 <code>GITHUB_TOKEN</code> 和 <code>GITHUB_REPOSITORY</code></li>
<li>如果您需要在测试环境中跳过检查，请修改源代码 <code>self.force_private_repo</code> 值</li>
</ul>
<ol start="3">
<li>运行脚本：</li>
</ol>
<pre data-lang="bash" class="language-bash "><code class="language-bash" data-lang="bash">python backup_script.py
</code></pre>
<h2 id="故障排除">故障排除</h2>
<h3 id="常见问题-1">常见问题</h3>
<ol>
<li>
<p><strong>🔒 仓库隐私检查失败</strong></p>
<ul>
<li><strong>问题</strong>: 显示“仓库当前为公开状态“错误</li>
<li><strong>解决</strong>: 将仓库设置为私有
<ol>
<li>前往 GitHub 仓库设置: <code>https://github.com/用户名/仓库名/settings</code></li>
<li>滚动到底部 <code>Danger Zone</code> 区域</li>
<li>点击 <code>Change repository visibility</code> → <code>Make private</code></li>
</ol>
</li>
<li><strong>注意</strong>: 程序会拒绝在公开仓库中备份敏感数据</li>
</ul>
</li>
<li>
<p><strong>GitHub API 访问失败</strong></p>
<ul>
<li><strong>问题</strong>: “无法验证仓库隐私状态”</li>
<li><strong>原因</strong>: GitHub Token 权限不足或网络问题</li>
<li><strong>解决</strong>: 确认 Actions 有足够权限访问仓库信息（通常 <code>GITHUB_TOKEN</code> 自动提供）</li>
</ul>
</li>
<li>
<p><strong>认证失败</strong></p>
<ul>
<li>检查用户名和密码是否正确</li>
<li>确认GitHub机密设置正确</li>
</ul>
</li>
<li>
<p><strong>网络连接问题</strong></p>
<ul>
<li>检查完整URL是否正确（http与非标准端口需要填写完整URL）</li>
<li>确认服务器端口是否开放</li>
<li>确认网站的完整API路径可访问</li>
<li>确保使用版本支持导出</li>
<li>确认网站没有IP限制</li>
<li>如果使用HTTP，确保服务器支持HTTP连接</li>
<li><strong>HTTP特有问题</strong>：某些网络环境可能阻止HTTP连接，建议先测试HTTPS</li>
</ul>
</li>
<li>
<p><strong>协议相关问题</strong></p>
<ul>
<li><strong>HTTP</strong>: 检查是否被防火墙或代理阻止</li>
<li><strong>HTTPS</strong>: 检查SSL证书是否有效</li>
<li><strong>端口</strong>: 确认自定义端口已正确开放</li>
<li><strong>超时</strong>: 如果服务器响应慢，可能需要增加超时时间</li>
</ul>
</li>
<li>
<p><strong>JSON解析错误</strong></p>
<ul>
<li>确认版本大于2.0.3</li>
<li>检查API是否正常工作</li>
</ul>
</li>
<li>
<p><strong>变更检测问题</strong></p>
<ul>
<li>如果怀疑变更检测有误，可以设置 <code>ENABLE_CHANGE_DETECTION=false</code> 强制备份</li>
<li>检查 <code>latest_backup.json</code> 文件是否存在且格式正确</li>
</ul>
</li>
<li>
<p><strong>配置错误</strong></p>
<ul>
<li>如果看到 <code>invalid literal for int()</code> 错误，检查 <code>MAX_BACKUPS</code> 是否设置了有效数字</li>
<li>可选配置项如果不需要可以不设置，程序会使用默认值</li>
</ul>
</li>
</ol>
<h3 id="本地测试方法">本地测试方法</h3>
<p>在配置GitHub Actions之前，建议先在本地测试连接：</p>
<pre data-lang="bash" class="language-bash "><code class="language-bash" data-lang="bash"># 测试HTTP连接
curl -v -u &quot;username:password&quot; &quot;http:&#x2F;&#x2F;&#x2F;api&#x2F;manage&#x2F;sysConfig&#x2F;backup?action=backup&quot;

# 测试HTTPS连接（如果支持）
curl -v -u &quot;username:password&quot; &quot;https:&#x2F;&#x2F;&#x2F;api&#x2F;manage&#x2F;sysConfig&#x2F;backup?action=backup&quot;

# 检查端口是否开放
telnet 11
</code></pre>
<h3 id="查看日志">查看日志</h3>
<p>在GitHub Actions页面可以查看详细的执行日志，包括：</p>
<ul>
<li>认证过程</li>
<li>下载进度</li>
<li>变更检测结果</li>
<li>文件保存状态</li>
<li>错误信息</li>
</ul>
<h2 id="自定义配置">自定义配置</h2>
<p>你可以修改以下设置：</p>
<h3 id="修改备份时间">修改备份时间</h3>
<p>编辑 <code>.github/workflows/backup.yml</code> 中的cron表达式：</p>
<pre data-lang="yaml" class="language-yaml "><code class="language-yaml" data-lang="yaml">schedule:
  - cron: &#x27;0 18 * * *&#x27;  # 每天UTC时间18:00（北京时间02:00）
</code></pre>
<h3 id="修改保留备份数量">修改保留备份数量</h3>
<p>编辑 <code>backup_script.py</code> 中的清理逻辑，或者在GitHub仓库机密中设置 <code>MAX_BACKUPS</code>：</p>
<pre data-lang="python" class="language-python "><code class="language-python" data-lang="python"># 默认保留最近的100个备份文件
self.max_backups = int(os.getenv(&#x27;MAX_BACKUPS&#x27;, &#x27;100&#x27;))
</code></pre>
<h3 id="禁用变更检测">禁用变更检测</h3>
<p>如果你希望每次都强制保存（不管数据是否变化），可以设置：</p>
<pre data-lang="yaml" class="language-yaml "><code class="language-yaml" data-lang="yaml"># 在GitHub仓库机密中设置
ENABLE_CHANGE_DETECTION: false
</code></pre>
<h2 id="安全注意事项">安全注意事项</h2>
<ol>
<li>
<p><strong>🔒 仓库隐私保护</strong>:</p>
<ul>
<li><strong>强制私有仓库</strong>: 程序强制要求仓库必须设置为私有状态，无法禁用</li>
<li><strong>自动检查机制</strong>: 程序会在每次运行前检查仓库隐私状态</li>
<li><strong>拒绝公开备份</strong>: 检测到公开仓库时会立即终止备份任务</li>
</ul>
</li>
<li>
<p><strong>机密管理</strong>:</p>
<ul>
<li>永远不要在代码中硬编码用户名和密码</li>
<li>使用GitHub Secrets安全存储敏感信息</li>
<li>定期轮换密码和访问令牌</li>
</ul>
</li>
<li>
<p><strong>访问权限</strong>:</p>
<ul>
<li>确保GitHub仓库的访问权限设置合适</li>
<li>仅向必要人员授予仓库访问权限</li>
<li>考虑启用分支保护规则</li>
</ul>
</li>
<li>
<p><strong>备份内容</strong>:</p>
<ul>
<li>备份文件可能包含用户数据、配置信息、API密钥等敏感信息</li>
<li>定期审查备份内容，确保没有意外包含不应备份的敏感数据</li>
<li>考虑对备份文件进行额外的加密处理</li>
</ul>
</li>
<li>
<p><strong>监控和审计</strong>:</p>
<ul>
<li>定期检查Actions运行日志</li>
<li>监控仓库访问记录</li>
<li>及时响应任何安全警告</li>
</ul>
</li>
</ol>
<p><strong>⚠️ 重要提醒</strong>: 数据安全是您的责任。虽然程序提供了多重保护机制，但请始终保持安全意识，确保正确配置和使用。</p>
<h2 id="贡献">贡献</h2>
<p>欢迎提交<a rel="noopener nofollow" target="_blank" href="https://github.com/yunsen2025/cloudflare-imgbed-auto-backup/issues">Issues</a>和<a rel="noopener nofollow" target="_blank" href="https://github.com/yunsen2025/cloudflare-imgbed-auto-backup/pulls">Pull Requests</a>来改进这个项目！</p>
<h2 id="许可证">许可证</h2>
<p>MIT License</p>

    </article>

    <!-- License -->
    <div class="mt-8 p-6 bg-gray-50 dark:bg-gray-700/50 rounded-2xl text-sm text-gray-600 dark:text-gray-400">
        <div class="flex flex-col gap-2">
            <p class="font-medium text-gray-900 dark:text-white">版权声明</p>
            <p>
                本文由 <span class="font-medium">二叉树树</span> 创作，采用 
                <a href="https:&#x2F;&#x2F;creativecommons.org&#x2F;licenses&#x2F;by-nc-sa&#x2F;4.0&#x2F;" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline">CC BY-NC-SA 4.0</a> 
                许可协议。
            </p>
            <p>
                转载请注明出处：<a href="https:&#x2F;&#x2F;blog.acofork.com&#x2F;posts&#x2F;cloudflare-imgbed-auto-backup&#x2F;" class="text-blue-600 dark:text-blue-400 hover:underline break-all">AcoFork Blog - cloudflare-imgbed项目使用Action自动备份元数据到仓库: https:&#x2F;&#x2F;blog.acofork.com&#x2F;posts&#x2F;cloudflare-imgbed-auto-backup&#x2F;</a>
            </p>
        </div>
    </div>

    <!-- Help & Edit -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-sm">
            <h3 class="font-bold text-gray-900 dark:text-white mb-2">这篇文章是否对你有帮助？</h3>
            <div class="flex space-x-4">
                <a href="&#x2F;posts&#x2F;pin" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">联系</a>
                <a href="&#x2F;sponsors" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">赞助</a>
            </div>
        </div>
        <div class="p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-sm">
            <h3 class="font-bold text-gray-900 dark:text-white mb-2">发现错误或想要改进这篇文章？</h3>
            <a href="https:&#x2F;&#x2F;github.com&#x2F;afoim&#x2F;AcoFork_Blog_Zola/blob/main/content/posts&#x2F;cloudflare-imgbed-auto-backup.md" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline flex items-center">
                <span>在 GitHub 上编辑此页</span>
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
            </a>
        </div>
    </div>

    <!-- Post Footer -->
    <footer class="mt-8 flex flex-wrap gap-2 justify-center">
        
        
        <a href="https://blog.acofork.com/tags/cloudflare/" class="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-full text-sm hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">#cloudflare</a>
        
        
    </footer>

    <!-- Comments (Giscus) -->
    <div class="mt-12 bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-sm">
<script src="https://giscus.app/client.js"
        data-repo="afoim/giscus-fuwari"
        data-repo-id="R_kgDOOi8quw"
        data-category="Announcements"
        data-category-id="DIC_kwDOOi8qu84CprDV"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>
    </div>
</div>

    </main>

    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col items-center justify-center space-y-2">
                <p class="text-gray-500 dark:text-gray-400 text-sm">
                    &copy; 2026 二叉树树. 
                    <a href="https:&#x2F;&#x2F;creativecommons.org&#x2F;licenses&#x2F;by-nc-sa&#x2F;4.0&#x2F;" target="_blank" class="hover:underline">CC BY-NC-SA 4.0</a>
                </p>
                <p class="text-gray-400 dark:text-gray-500 text-xs">
                    Powered by <a href="https://www.getzola.org" target="_blank" class="hover:text-gray-300">Zola</a>
                     · <a href="https://github.com/afoim/AcoFork_Blog_Zola" target="_blank" class="hover:text-gray-300">Source Code</a>
                </p>
                <a href="https://blog.acofork.com/rss.xml" target="_blank" class="text-gray-400 hover:text-orange-500 dark:hover:text-orange-400 transition-colors p-2">
                    <span class="sr-only">RSS</span>
                    <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <path d="M5 3a1 1 0 000 2c5.523 0 10 4.477 10 10a1 1 0 102 0C17 8.373 11.627 3 5 3z"></path>
                        <path d="M4 9a1 1 0 011-1 7 7 0 017 7 1 1 0 11-2 0 5 5 0 00-5-5 1 1 0 01-1-1zM3 15a2 2 0 114 0 2 2 0 01-4 0z"></path>
                    </svg>
                </a>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
    <script src="/js/umami-share.js"></script>
    <script src="/js/search.js"></script>
    <script src="/js/gfm-alerts.js"></script>
    <script src="/js/anchor-fix.js"></script>
    <script>
        // Umami script needs to be loaded if it's not already
        // This is a workaround since we removed the original script tag
        (function() {
            var el = document.createElement('script');
            el.setAttribute('src', 'https://umami.acofork.com/script.js');
            el.setAttribute('data-website-id', '5d710dbd-3a2e-43e3-a553-97b415090c63');
            el.setAttribute('defer', '');
            document.body.appendChild(el);
        })();
    </script>
</body>
</html>
